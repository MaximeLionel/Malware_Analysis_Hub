


# Static Analysis Clues
* source of malware: lab03-03 of book 'practical malware analysis'.
* md5,E2BF42217A67E46433DA8B6F4507219E.
* sha1,DAF263702F11DC0430D30F9BF443E7885CF91FCB.
* sha256,AE8A1C7EB64C42EA2A04F97523EBF0844C27029EB040D910048B680F884B9DCE.
* entropy,4.965 - **unpacked**.
* compiler-stamp,0x4D9F4BCF (Sat Apr 09 01:54:23 2011).
* The file contains **another file**,signature: unknown, location: .**rsrc**, offset: 0x00006084, size: 24576,1
* The file references a group of API,type: keyboard-and-mouse,3 - **keylogger**
* The file references a group of API,type: memory,3
* The file references a group of API,type: file,3
* Imports:
  * GetThreadContext,0x167,0x4622,reckoning,implicit,-,x,kernel32.dll
  * WriteProcessMemory,0x2E9,0x45C0,memory,implicit,-,x,kernel32.dll
  * ReadProcessMemory,0x21C,0x460E,memory,implicit,-,x,kernel32.dll
  * SetThreadContext,0x283,0x45AC,execution,implicit,-,x,kernel32.dll
  * TerminateProcess,0x29E,0x46F4,execution,implicit,-,x,kernel32.dll
  * GetEnvironmentStrings,0x106,0x4798,execution,implicit,-,x,kernel32.dll
* Use scp to transfer malware from winvm to remnux.
* behavior: ThreadControl Context, win files operation, xor
  * xor: 0x60d2           )(2a13.&3 ,a" //.5a#$a34/a(/aa,.%$o

# Dynamic Analysis Clues
* malware create process svchost.exe. Then malware procecss exit and leave svchost as an **orphaned** process.
![svchost](./explorer.png)
* By checking strings of svchost property in memory, find strings: practicalmalwareanalysis.log, [ENTER] - clues of keylogger.
* also find CreateFile and WriteFile to manipulate practicalmalwareanalysis.log.

# Use IDA to analyze.
* malware tries to get the full path of svchost.exe and I guess it will use the process memory space of svchost.exe.
![svchostpath](./svchostpath.png)
* get the pointer of the resourcec and decode it and it's actually a hiden malware. xor-key as below:
![decodekey](./decode.png)
* malware will start svchost.exe process and copy the hidden malware into the process memory space. Then run the hiden malware.
* After dump the hiden malware and analyze, I find it's a keylogger.
![sethook](./sethook.png)
![keydown](./keydown.png)